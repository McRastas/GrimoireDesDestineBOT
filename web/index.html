<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≤ Calculateur de PV D&D 5e - Grimoire des Destin√©es</title>
    <link rel="stylesheet" href="styles-unified.css">
</head>
<body>
    <!-- Navigation -->
    <div class="nav-links">
        <a href="index.html" class="nav-link active">üé≤ Calculateur PV</a>
        <a href="maj-fiche-dev.html" class="nav-link">üìù G√©n√©rateur Fiche (DEV)</a>
    </div>

    <div class="container">
        <div class="header">
            <h1>üé≤ Calculateur de PV D&D 5e</h1>
            <p>Calculez automatiquement les points de vie de vos personnages</p>
        </div>

        <div class="main-content">
            <div class="info-box">
                <strong>üìñ Comment √ßa marche :</strong><br>
                ‚Ä¢ <strong>PV de base :</strong> Barbare (12), Guerrier/R√¥deur/Paladin (10), Clerc/Druide/Moine/etc. (8), Magicien/Ensorceleur (6)<br>
                ‚Ä¢ <strong>PV par niveau :</strong> Barbare (+7), Guerrier/R√¥deur/Paladin (+6), Clerc/Druide/Moine/etc. (+5), Magicien/Ensorceleur (+4)<br>
                ‚Ä¢ <strong>Bonus racial :</strong> Nains des collines : +1 PV par niveau, toutes les autres races : aucun bonus<br>
                ‚Ä¢ <strong>Constitution :</strong> Ajoute (Constitution - 10) √∑ 2 √ó niveau total
            </div>

            <div id="characters-container">
                <!-- Les personnages seront ajout√©s ici -->
            </div>

            <button class="btn-primary add-character" onclick="addCharacter()">
                ‚ûï Ajouter un personnage
            </button>
        </div>
    </div>

    <script>
        const classData = {
            'Barbare': { base: 12, perLevel: 7 },
            'Guerrier': { base: 10, perLevel: 6 },
            'R√¥deur': { base: 10, perLevel: 6 },
            'Paladin': { base: 10, perLevel: 6 },
            'Roublard': { base: 8, perLevel: 5 },
            'Barde': { base: 8, perLevel: 5 },
            'Artificier': { base: 8, perLevel: 5 },
            'Clerc': { base: 8, perLevel: 5 },
            'Druide': { base: 8, perLevel: 5 },
            'Moine': { base: 8, perLevel: 5 },
            'Occultiste': { base: 8, perLevel: 5 },
            'Magicien': { base: 6, perLevel: 4 },
            'Ensorceleur': { base: 6, perLevel: 4 }
        };

        const races = [
            'Autre race', 
            'Nain des collines (+1 PV/niveau)'
        ];

        const classes = [
            'Barbare', 'Guerrier', 'R√¥deur', 'Paladin', 'Roublard', 'Barde', 
            'Artificier', 'Clerc', 'Druide', 'Moine', 'Occultiste', 'Magicien', 'Ensorceleur'
        ];

        let characterCount = 0;

        function generateCharacterHTML(id) {
            const raceOptions = races.map(race => `<option value="${race}">${race}</option>`).join('');
            const classOptions = classes.map(cls => `<option value="${cls}">${cls}</option>`).join('');

            return `
                <div class="character-card fade-in" id="character-${id}">
                    <div class="flex-between mb-20">
                        <input type="text" class="character-name" placeholder="Nom du personnage" style="max-width: 300px;">
                        <div class="pv-display" style="min-width: 120px;">
                            <div class="pv-number">10</div>
                            <div class="pv-label">Points de Vie</div>
                        </div>
                        ${id > 1 ? `<button class="btn-danger delete-character" onclick="removeCharacter(${id})" title="Supprimer ce personnage">üóëÔ∏è</button>` : ''}
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>Race</label>
                            <select class="race-select" onchange="updateCharacterPV(${id})">
                                ${raceOptions}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Constitution</label>
                            <input type="number" class="constitution" value="10" min="1" max="30" onchange="updateCharacterPV(${id})">
                        </div>
                    </div>

                    <div class="form-section" style="background: white; padding: 20px;">
                        <h4 style="margin-bottom: 15px;">‚öîÔ∏è Classes et Niveaux</h4>
                        <div class="classes-container">
                            <div class="class-entry form-grid mb-15">
                                <div class="form-group">
                                    <label>Classe</label>
                                    <select class="class-select" onchange="updateCharacterPV(${id})">
                                        <option value="">S√©lectionnez une classe</option>
                                        ${classOptions}
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Niveau</label>
                                    <input type="number" class="level" value="1" min="1" max="20" onchange="updateCharacterPV(${id})">
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn-secondary add-class mt-10" onclick="addClassToCharacter(${id})">+ Ajouter une classe (multiclassage)</button>
                    </div>

                    <div class="form-section" style="background: white; padding: 20px; margin-top: 15px;">
                        <h4 style="margin-bottom: 15px;">‚ú® Bonus suppl√©mentaires</h4>
                        
                        <div class="checkbox-grid">
                            <div class="checkbox-group">
                                <input type="checkbox" id="robuste-${id}" class="feat-robuste" onchange="updateCharacterPV(${id})">
                                <label for="robuste-${id}">Don : Robuste (+2 PV/niveau)</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="armure-${id}" class="armure-safeguard" onchange="updateCharacterPV(${id})">
                                <label for="armure-${id}">Armure de Safeguard (+10 +1/niveau)</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="hache-${id}" class="hache-berserker" onchange="updateCharacterPV(${id})">
                                <label for="hache-${id}">Hache du Berserker (+1 PV/niveau)</label>
                            </div>
                            
                            <div class="checkbox-group">
                                <input type="checkbox" id="draconic-${id}" class="ensorceleur-draconique" onchange="updateCharacterPV(${id})">
                                <label for="draconic-${id}">Ensorceleur : Lign√©e draconique (+1 PV/niveau)</label>
                            </div>
                        </div>
                    </div>

                    <div class="breakdown">
                        <h4>üìä D√©tail du Calcul</h4>
                        <div class="breakdown-content">
                            <div class="breakdown-item">
                                <span>PV de base :</span>
                                <span class="base-pv">0</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Modificateur Constitution :</span>
                                <span class="constitution-bonus">0</span>
                            </div>
                            <div class="breakdown-item">
                                <span>PV par niveaux :</span>
                                <span class="level-pv">0</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Bonus racial :</span>
                                <span class="racial-bonus">0</span>
                            </div>
                            <div class="breakdown-item">
                                <span>Dons et objets :</span>
                                <span class="bonus-total">0</span>
                            </div>
                            <div class="breakdown-item breakdown-total">
                                <span><strong>TOTAL :</strong></span>
                                <span class="total-breakdown">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function addCharacter() {
            characterCount++;
            const container = document.getElementById('characters-container');
            const characterHTML = generateCharacterHTML(characterCount);
            container.insertAdjacentHTML('beforeend', characterHTML);
            updateCharacterPV(characterCount);
        }

        function removeCharacter(id) {
            const character = document.getElementById(`character-${id}`);
            if (character && confirm('√ätes-vous s√ªr de vouloir supprimer ce personnage ?')) {
                character.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => character.remove(), 300);
            }
        }

        function addClassToCharacter(characterId) {
            const character = document.getElementById(`character-${characterId}`);
            const classesContainer = character.querySelector('.classes-container');
            const classCount = classesContainer.querySelectorAll('.class-entry').length;
            
            if (classCount >= 4) {
                alert('Maximum de 4 classes atteint pour le multiclassage');
                return;
            }

            const classOptions = classes.map(cls => `<option value="${cls}">${cls}</option>`).join('');
            
            const newClassHTML = `
                <div class="class-entry form-grid mb-15 fade-in">
                    <div class="form-group">
                        <label>Classe ${classCount + 1}</label>
                        <select class="class-select" onchange="updateCharacterPV(${characterId})">
                            <option value="">S√©lectionnez une classe</option>
                            ${classOptions}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Niveau</label>
                        <div class="flex gap-10">
                            <input type="number" class="level" value="1" min="1" max="20" onchange="updateCharacterPV(${characterId})">
                            <button class="btn-danger" onclick="removeClassEntry(this, ${characterId})" style="padding: 8px 12px;">‚úï</button>
                        </div>
                    </div>
                </div>
            `;
            
            classesContainer.insertAdjacentHTML('beforeend', newClassHTML);
        }

        function removeClassEntry(button, characterId) {
            const classEntry = button.closest('.class-entry');
            classEntry.style.animation = 'fadeOut 0.3s ease';
            setTimeout(() => {
                classEntry.remove();
                updateCharacterPV(characterId);
            }, 300);
        }

        function calculateCharacterPV(characterId) {
            const character = document.getElementById(`character-${characterId}`);
            if (!character) return { total: 0, base: 0, constitution: 0, level: 0, racial: 0, bonus: 0 };

            const constitution = parseInt(character.querySelector('.constitution').value) || 10;
            const constitutionModifier = Math.floor((constitution - 10) / 2);
            
            const race = character.querySelector('.race-select').value;
            const isHillDwarf = race.includes('Nain des collines');
            
            const classEntries = character.querySelectorAll('.class-entry');
            let basePV = 0;
            let levelPV = 0;
            let totalLevel = 0;
            let sorcererLevels = 0;
            let firstClass = true;

            classEntries.forEach(entry => {
                const classSelect = entry.querySelector('.class-select');
                const levelInput = entry.querySelector('.level');
                const selectedClass = classSelect.value;
                const level = parseInt(levelInput.value) || 0;

                if (selectedClass && classData[selectedClass] && level > 0) {
                    totalLevel += level;
                    
                    if (selectedClass === 'Ensorceleur') {
                        sorcererLevels += level;
                    }

                    if (firstClass) {
                        basePV = classData[selectedClass].base;
                        levelPV += classData[selectedClass].perLevel * (level - 1);
                        firstClass = false;
                    } else {
                        levelPV += classData[selectedClass].perLevel * level;
                    }
                }
            });

            const constitutionBonus = constitutionModifier * totalLevel;
            const racialBonus = isHillDwarf ? totalLevel : 0;
            
            const featRobuste = character.querySelector('.feat-robuste').checked;
            const featBonus = featRobuste ? 2 * totalLevel : 0;

            let itemBonus = 0;
            const armureSafeguard = character.querySelector('.armure-safeguard').checked;
            const hacheBerserker = character.querySelector('.hache-berserker').checked;
            
            if (armureSafeguard) {
                itemBonus += 10 + totalLevel;
            }
            if (hacheBerserker) {
                itemBonus += totalLevel;
            }

            const ensorceleurDraconique = character.querySelector('.ensorceleur-draconique').checked;
            const draconicBonus = ensorceleurDraconique ? sorcererLevels : 0;

            const totalPV = basePV + constitutionBonus + levelPV + racialBonus + featBonus + itemBonus + draconicBonus;

            return {
                total: totalPV,
                base: basePV,
                constitution: constitutionBonus,
                level: levelPV + draconicBonus,
                racial: racialBonus,
                bonus: featBonus + itemBonus
            };
        }

        function updateCharacterPV(characterId) {
            const result = calculateCharacterPV(characterId);
            const character = document.getElementById(`character-${characterId}`);
            
            if (!character) return;
            
            // Mettre √† jour l'affichage principal
            character.querySelector('.pv-number').textContent = result.total;
            
            // Mettre √† jour le d√©tail
            character.querySelector('.base-pv').textContent = result.base;
            character.querySelector('.constitution-bonus').textContent = result.constitution > 0 ? `+${result.constitution}` : result.constitution;
            character.querySelector('.level-pv').textContent = result.level;
            character.querySelector('.racial-bonus').textContent = result.racial;
            character.querySelector('.bonus-total').textContent = result.bonus;
            character.querySelector('.total-breakdown').textContent = result.total;
        }

        // Ajouter les animations CSS n√©cessaires
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; transform: scale(1); }
                to { opacity: 0; transform: scale(0.95); }
            }
        `;
        document.head.appendChild(style);

        // Ajouter un personnage par d√©faut au chargement
        document.addEventListener('DOMContentLoaded', function() {
            addCharacter();
        });
    </script>
</body>
</html>